create_MSI_effect = {
	create_species = {
		name = random
		class = MSI_SLAVER
		namelist = HUMAN3
		portrait = random
		traits = {
			trait = "trait_pc_nuked_preference"
			trait = "trait_charismatic"
			trait = "trait_intelligent"
			trait = "trait_decadent"
			trait = "trait_wasteful"
		}
		allow_negative_traits = yes
	}

	create_country = {
		name = "NAME_MSI_country"
		adjective = "ADJ_MSI_country"
		species = last_created_species
		type = default
		flag = {
			icon = {
				category = "corporate"
				file = "corporate_07.dds"
			}
			background= {
				category = "backgrounds"
				file = "pattern_01.dds"
			}
			colors={
				"mist_blue"
				"bright_purple"
				"null"
				"null"
			}
		}
		origin = "origin_slavers"
		ethos = {
			ethic = ethic_xenophile
			ethic = ethic_authoritarian
			ethic = ethic_fanatic_capitalism # E&CC Compatibility and twist
			ethic = ethic_industrial
		}
		civics = {
			civic = civic_indentured_assets
			civic = civic_state_monopoly
			civic = civic_public_relations_specialists
		}
		authority = auth_corporate
		effect = {
			save_global_event_target_as = MSI_country
			set_country_flag = MSI

			every_country = {
				limit = {
					has_slave_origin = yes
					#Cog Note - These origins below have not met MSI yet
					NOR = {
						has_civic = PrimPlayer_civic_the_obelisk
						has_origin = origin_primitive_player_pre_industrial_age
						has_origin = origin_primitive_player_industrial_age
						has_origin = origin_primitive_player_machine_age
						has_origin = origin_primitive_player_atomic_age
						has_origin = origin_primitive_player_early_space_age
					}
					NOT = { has_country_flag = slavers_assigned }
				}
				set_country_flag = slavers_assigned
				event_target:MSI_country = {
					set_country_flag = slavers_of_@prev
					set_country_flag = special_intro_for@prev
					add_opinion_modifier = {
						who = prev
						modifier = opinion_former_slaves
					}
				}
				species = { set_species_flag = victims_of_@event_target:MSI_country }
				set_country_flag = victims_of_@event_target:MSI_country
				add_opinion_modifier = {
					who = event_target:MSI_country
					modifier = opinion_slavers
				}
			}
		}
	}

	create_colony = {
		owner = event_target:MSI_country
	}
	generate_start_deposits_and_blockers = yes
	generate_start_buildings_and_districts = yes
	generate_start_pops = yes
	event_target:MSI_country = {
		create_starting_leaders = yes
		country_event = { id = game_start.9 }
		owner_species = { set_species_homeworld = prevprev }
		log = "MSI CREATED"
	}
}

generate_slaver_bonus = {
	set_timed_planet_flag = {
		flag = ignore_ai_building_limitations
		days = 1
	}
	while = {
		count = 2
		add_district_and_planet_size_if_needed_effect = {
			district = district_city
		}
	}
	while = {
		count = 2
		add_district_and_planet_size_if_needed_effect = {
			district = district_mining
		}
	}
	add_district_and_planet_size_if_needed_effect = {
		district = district_generator
	}
	add_district_and_planet_size_if_needed_effect = {
		district = district_farming
	}

	owner = {
		set_policy = {
			policy = slavery
			option = slavery_allowed
			cooldown = no
		}
	}

	while = {
		limit = { pop_amount > 3600 }
		random_owned_pop_group = {
			kill_single_pop = yes
		}
	}

	# Checking if there are any other pre-ftls to abduct
	while = {
		limit = { pop_amount < 5200 }
		if = {
			limit = {
				any_country = {
					species = {
						ideal_planet_is_special = no
						NOT = { has_trait = trait_hive_mind }
					}
					is_preftl_but_not_special = yes
				}
			}
			random_country = {
				limit = {
					species = {
						ideal_planet_is_special = no
						NOT = { has_trait = trait_hive_mind }
					}
					is_preftl_but_not_special = yes
				}
				owner_species = {
					# first species to get kidnapped becomes the species of the debt collectors
					save_event_target_as = random_primitive_species
					if = {
						limit = {
							NOT = {
								exists = event_target:debt_collectors_species
							}
						}
						save_global_event_target_as = debt_collectors_species
					}
				}

				prev.owner = {
					set_visited = prev.capital_scope.solar_system
				}
			}

			create_pop_group = {
				species = event_target:random_primitive_species
				effect = {
					save_event_target_as = last_created_pop_group
				}
			}

			event_target:last_created_pop_group = {
				set_citizenship_type = {
					type = citizenship_slavery
				}
			}
		}
	}

	while = {
		limit = { pop_amount < 8100 }

		random_country = {
			limit = {
				has_slave_origin = yes
				#Cog Note - These origins below have not met MSI yet
				NOR = {
					has_civic = PrimPlayer_civic_the_obelisk
					has_origin = origin_primitive_player_pre_industrial_age
					has_origin = origin_primitive_player_industrial_age
					has_origin = origin_primitive_player_machine_age
					has_origin = origin_primitive_player_atomic_age
					has_origin = origin_primitive_player_early_space_age
				}
			}

			owner_species = {
				save_event_target_as = random_slave_species
			}

			prev.owner = {
				set_visited = prev.capital_scope.solar_system
			}
		}

		create_pop_group = {
			species = event_target:random_slave_species
			effect = {
				save_event_target_as = last_created_pop_group
			}
		}
		event_target:last_created_pop_group = {
			set_citizenship_type = {
				type = citizenship_slavery
			}
		}
	}

	owner = {
		# Unlocks slave processing facilities
		give_technology = {
			message = no
			tech = tech_neural_implants
		}
		# Unlocks gene clinics
		give_technology = {
			message = no
			tech = tech_frontier_health
		}
		give_technology = {
			message = no
			tech = tech_food_processing_1
		}
		give_technology = {
			message = no
			tech = tech_mineral_purification_1
		}
		give_technology = {
			message = no
			tech = tech_power_hub_1
		}
	}
	add_building = building_slave_processing
	add_building = building_precinct_house
	add_building = building_medical_2

	owner = {
		add_resource = {
			minerals = 2400
			energy = 2400
			food = 2400
			alloys = 800
			consumer_goods = 1200
			influence = 600
		}
	}

	owner = {
		create_fleet = {
			effect = {
				set_owner = prev
				create_ship = {
					name = random
					random_existing_design = science
				}
				set_fleet_stance = evasive
				set_location = prev.capital_scope.star
				owner = {
					create_leader = {
						class = scientist
						sub_type = survey
						name = random
						species = owner_main_species
					}
				}
				set_leader = last_created_leader
			}
		}
		while = {
			count = 2
			create_fleet = {
				name = "NAME_Payback_Warship_MSI"
				effect = {
					set_owner = prev
					create_ship = {
						name = "NAME_Payback_Warship_MSI"
						design = "NAME_Payback_Warship_MSI"
						graphical_culture = "slaver_01"
						upgradable = no
						effect = {
							set_ship_flag = payback_flagship
						}
					}
					set_location = prev.capital_scope.star
				}
				settings = {
					spawn_debris = no
					can_upgrade = no
					can_change_composition = no
					uses_naval_capacity = no
				}
			}
		}
	}
}

uplift_pre_ftl_with_origin_effect = {
	random_country = {
		limit = {
			is_hive_empire = no
			species = {
				ideal_planet_is_special = no
				NOt = { is_same_value = root.species }
			}
			is_preftl_but_not_special = yes
		}
		if = {
			limit = {
				is_xenophobe = yes
			}
			if = {
				limit = { has_ethic = ethic_fanatic_xenophobe }
				country_remove_ethic = ethic_fanatic_xenophobe
				country_add_ethic = ethic_fanatic_xenophile
			}
			else = {
				country_remove_ethic = ethic_xenophobe
				country_add_ethic = ethic_xenophile
			}
		}
		if = {
			limit = {
				is_authoritarian = yes
			}
			if = {
				limit = { prev = { has_ethic = ethic_fanatic_authoritarian } }
				country_remove_ethic = ethic_fanatic_authoritarian
				country_add_ethic = ethic_fanatic_egalitarian
			}
			else = {
				country_remove_ethic = ethic_authoritarian
				country_add_ethic = ethic_egalitarian
			}
		}
		if = {
			limit = {
				is_capitalism = yes
			}
			if = {
				limit = { prev = { has_ethic = ethic_fanatic_capitalism } }
				country_remove_ethic = ethic_fanatic_capitalism
				country_add_ethic = ethic_fanatic_socialism
			}
			else = {
				country_remove_ethic = ethic_capitalism
				country_add_ethic = ethic_socialism
			}
		}
		save_event_target_as = uplifted_country
		remove_pre_ftl_flags = yes
		set_country_type = default
		change_country_flag = random
		set_species_graphical_culture = yes
		change_government = {
			authority = random
			civics = random
		}
		set_name = random
		capital_scope = {
			every_deposit = {
				remove_deposit = yes
			}
			remove_all_districts = yes
			remove_all_buildings = yes
		}
		set_origin = $ORIGIN$
		capital_scope = {
			solar_system = {
				generate_home_system_resources = yes
				create_starbase = {
					size = starbase_starport
					module = shipyard
					building = crew_quarters
					owner = event_target:uplifted_country
					effect = {
						set_starbase_module = {
							slot = 1
							module = trading_hub
						}
					}
				}
			}
			generate_start_deposits_and_blockers = yes
			generate_start_buildings_and_districts = yes
			generate_start_pops = yes
			generate_home_planet_final_pass = yes
		}
		switch = {
			trigger = has_origin
			origin_broken_shackles = {
				country_event = { id = origin.110 }
				capital_scope = {
					while = {
						limit = { pop_amount > 2800 }
						random_owned_pop_group = {
							kill_single_pop = yes
						}
					}
				}
			}
			origin_payback = {
				country_event = { id = origin.4000 }
				capital_scope = {
					while = {
						limit = { pop_amount > 1800 }
						random_owned_pop_group = {
							kill_single_pop = yes
						}
					}
				}
			}
		}
	}
}

### Fear of the Dark ###

create_fear_of_the_dark_country = {
	create_country = {
		name = {
			key = "NAME_fotd_seperatists"
			variable_string = "\\[fotd_country.GetSpeciesName\\]"
		}
		authority = auth_democratic
		civics = {
			civic = civic_idealistic_foundation
			civic = civic_environmentalist
		}
		species = event_target:fotd_country.species
		ethos = {
			ethic = ethic_fanatic_xenophobe
			ethic = ethic_egalitarian
			ethic = ethic_socialism # E&CC Compatibility
			ethic = ethic_green # E&CC Compatibility
		}

		flag = random
		origin = "origin_fear_of_the_dark" # Should only be visible if they become spacefaring
		type = primitive
		effect = {
			set_country_flag = early_space_age
			set_country_flag = fotd_seperatist_country@event_target:fotd_country
			set_country_flag = fotd_seperatist_country
			save_event_target_as = fotd_seperatist_country
			establish_communications_no_message = event_target:fotd_country
			set_faction_hostility = {
				target = event_target:fotd_country set_friendly = yes }
		}
	}
	event_target:fotd_country = {
		add_intel = {
			amount = 100
			who = event_target:fotd_seperatist_country
		}
	}
}
