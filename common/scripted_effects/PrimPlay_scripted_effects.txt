# increase/decrease_planet_temperature = {}

# wipe_pop_ethos = {}

# reset_planet = { reroll_deposits = yes }

# Given a species, create a mod with trait_cybernetic and apply to all pops, leaders
# And armies that have the original species and the same owner as the scope object.
# Scope: Something that has a species and an owner
# create_cybernetic_species_mod = {

#THIS = Planet Scope
PrimPlayer_nuclear_winter_planet_setup = {
			add_planet_devastation = 90
			hidden_effect = {
				if = {
					limit = { has_deposit = d_PrimPlayer_the_obelisk_deposit }
					set_planet_flag = d_PrimPlayer_the_obelisk_deposit
				}
				if = {
					limit = { has_deposit = d_PrimPlayer_nation_deposit }
					set_planet_flag = d_PrimPlayer_nation_deposit
				}
			}
			reroll_deposits = yes
			hidden_effect = {
				if = {
					limit = { has_planet_flag = d_PrimPlayer_the_obelisk_deposit }
					add_deposit = d_PrimPlayer_the_obelisk_deposit
					remove_planet_flag = d_PrimPlayer_the_obelisk_deposit
				}
				if = {
					limit = { has_planet_flag = d_PrimPlayer_nation_deposit }
					add_deposit = d_PrimPlayer_nation_deposit
					remove_planet_flag = d_PrimPlayer_nation_deposit
				}
			}
			add_modifier = {
				modifier = "irradiated_wasteland"
				days = 3600
			}
			add_blocker = {
				type = d_radioactive_wasteland
				blocked_deposit = random
			}
			add_blocker = {
				type = d_radioactive_wasteland
				blocked_deposit = random
			}
			add_blocker = {
				type = d_city_ruins
				blocked_deposit = random
			}
			add_blocker = {
				type = d_bomb_crater
				blocked_deposit = random
			}
			weighted_random_owned_pop_group = {
				kill_pop_group = {
					pop_group = this
					amount = 700
				}
			}
			every_owned_pop_group = {
				modify_species = {
					species = THIS
					add_trait = trait_survivor
					#ideal_planet_class = pc_nuked	#Cog Note - Technically this is recent, not evolved, and potentially too disruptive to gameplay... unfun?
				}
			}
}

ethic_fanatic_nation_setup_effect = {
	add_modifier = {
		modifier = PrimPlayer_ethic_fanatic_nation_modifier
		days = -1
	}
	if = {
		limit = {
			ROOT = {
				OR = {
					has_origin = origin_primitive_player_atomic_age
					has_origin = origin_primitive_player_early_space_age
				}
			} 
		}
		give_technology = { tech = tech_missiles_1 message = no }	#Cog Note - if starting at this age, they need nuclear warhead technology
	}
	establish_communications_no_message = root
	create_leader = {
		class = official
		species = root
		name = random
		event_leader = yes
		skill = 1
		set_age = 0
	}
	set_leader = last_created_leader
	# save_global_event_target_as = gray_country
}

primitive_nation_absorption_effect = {
	#hidden_effect = {
		if = {
			limit = { planet = { is_planet_class = pc_nuked } }
			hidden_effect = {
				if = {
					limit = {
						any_owned_pop_group = {
							NOR = { has_trait = trait_hive_mind is_robot_pop_group = yes }
						}
					}
					random_owned_pop_group = {
						limit = {
							NOR = { has_trait = trait_hive_mind is_robot_pop_group = yes }
						}
						root = {
							if = {
								limit = { has_planet_flag = PrimPlayer_authoritarian_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_authoritarian }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_egalitarian_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_egalitarian }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_xenophobe_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_xenophobe }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_xenophile_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_xenophile }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_militarist_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_militarist }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_pacifist_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_pacifist }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_spiritualist_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_spiritualist }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_materialist_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_materialist }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_green_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_green }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_industrial_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_industrial }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_socialism_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_socialism }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_capitalism_union_situation_complete }
								create_pop_group = {
									size = 300
									species = prev
									ethos = { ethic = ethic_capitalism }
								}
							}
							else = {	#Fallback
								create_pop_group = {
									size = 300
									species = prev
								}
							}
						}
					}
				}
				else = {
					random_owned_pop_group = {
						root = {
							create_pop_group = {
								size = 300
								species = prev
							}
						}
					}
				}
			}
			add_planet_devastation = -12
			custom_tooltip = d_primitive_nation_absorption_tomb_tooltip
		}
		else = {
			hidden_effect = {
				if = {
					limit = {
						any_owned_pop_group = {
							NOR = { has_trait = trait_hive_mind is_robot_pop_group = yes }
						}
					}
					random_owned_pop_group = {
						limit = {
							NOR = { has_trait = trait_hive_mind is_robot_pop_group = yes }
						}
						root = {
							if = {
								limit = { has_planet_flag = PrimPlayer_authoritarian_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_authoritarian }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_egalitarian_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_egalitarian }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_xenophobe_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_xenophobe }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_xenophile_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_xenophile }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_militarist_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_militarist }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_pacifist_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_pacifist }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_spiritualist_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_spiritualist }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_materialist_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_materialist }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_green_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_green }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_industrial_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_industrial }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_socialism_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_socialism }
								}
							}
							else_if = {
								limit = { has_planet_flag = PrimPlayer_capitalism_union_situation_complete }
								create_pop_group = {
									size = 1000
									species = prev
									ethos = { ethic = ethic_capitalism }
								}
							}
							else = {	#Fallback
								create_pop_group = {
									size = 1000
									species = prev
								}
							}
						}
					}
				}
				else = {
					random_owned_pop_group = {
						root = {
							create_pop_group = {
								size = 1000
								species = prev
							}
						}
					}
				}
			}
			custom_tooltip = d_primitive_nation_absorption_effect_tooltip
		}
		hidden_effect = { country_event = { id = nations.6 } }
	#}
}

nuclear_winter_clear_nation_deposit_flag = {
			hidden_effect = {
				if = {
					limit = { has_ethic = ethic_fanatic_authoritarian }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_authoritarian_nation_blocker set_planet_flag = PrimPlayer_authoritarian_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_egalitarian }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_egalitarian_nation_blocker set_planet_flag = PrimPlayer_egalitarian_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_xenophobe }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_xenophobe_nation_blocker set_planet_flag = PrimPlayer_xenophobe_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_xenophile }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_xenophile_nation_blocker set_planet_flag = PrimPlayer_xenophile_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_militarist }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_militarist_nation_blocker set_planet_flag = PrimPlayer_militarist_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_pacifist }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_pacifist_nation_blocker set_planet_flag = PrimPlayer_pacifist_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_spiritualist }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_spiritualist_nation_blocker set_planet_flag = PrimPlayer_spiritualist_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_materialist }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_materialist_nation_blocker set_planet_flag = PrimPlayer_materialist_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_green }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_green_nation_blocker set_planet_flag = PrimPlayer_green_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_industrial }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_industrial_nation_blocker set_planet_flag = PrimPlayer_industrial_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_socialism }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_socialism_nation_blocker set_planet_flag = PrimPlayer_socialism_union_situation_complete } }
				}
				else_if = {
					limit = { has_ethic = ethic_fanatic_capitalism }
					ROOT = { capital_scope = { add_deposit = d_ethic_fanatic_capitalism_nation_blocker set_planet_flag = PrimPlayer_capitalism_union_situation_complete } }
				}
			}
}

# generate_home_system_resources = {

generate_start_buildings_and_blockers = {
	random_tile = {
		limit = { has_blocker = no has_building = no num_adjacent_tiles > 3 }
		set_building = "building_colony_shelter"
		set_deposit = d_energy_deposit				
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_primitive_farm"
			set_deposit = d_rich_farmland_deposit						
		}
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_primitive_farm"
			set_deposit = d_rich_farmland_deposit						
		}
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_primitive_power_plant"
			set_deposit = d_rich_energy_deposit					
		}
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_primitive_power_plant"
			set_deposit = d_rich_mineral_deposit
		}				
	}
	random_tile = {
		limit = { has_blocker = no has_building = no }
		set_building = "building_basic_science_lab_1"
		random_list = {
			33 = { 
				set_deposit = d_engineering_deposit										
			}
			33 = { 
				set_deposit = d_society_deposit											
			}
			33 = { 
				set_deposit = d_physics_deposit											
			}					
		}					
	}
	random_tile = {
		limit = { has_blocker = no has_building = no }
		set_building = "building_primitive_power_plant"
		set_deposit = d_mineral_deposit					
	}				
	random_tile = {
		limit = { has_blocker = no has_building = no }
		set_blocker = "tb_failing_infrastructure"
		set_deposit = d_engineering_deposit			
	}
	random_tile = {
		limit = { has_blocker = no has_building = no }
		set_blocker = "tb_failing_infrastructure"
		set_deposit = d_society_deposit			
	}
	random_tile = {
		limit = { has_blocker = no has_building = no }
		set_blocker = "tb_failing_infrastructure"
		set_deposit = d_physics_deposit			
	}
	random_tile = {
		limit = { has_blocker = no has_building = no }
		set_blocker = "tb_decrepit_dwellings"
		set_deposit = d_rich_energy_deposit				
	}
	random_tile = {
		limit = { has_blocker = no has_building = no }
		set_blocker = "tb_decrepit_dwellings"
		set_deposit = d_rich_farmland_deposit				
	}
	random_tile = {
		limit = { has_blocker = no has_building = no }
		set_blocker = "tb_decrepit_dwellings"
		set_deposit = d_rich_mineral_deposit			
	}
	random_tile = {
		limit = { has_blocker = no has_building = no }
		set_building = "building_primitive_power_plant"
		set_deposit = d_rich_energy_deposit			
	}	
}

reset_start_buildings_and_blockers_post_apoc = { # Selectively resets necessary tiles for Post-Apoc Civic users. Relies on "generate_start_buildings_and_blockers" and game_start.32
	random_tile = {
		limit = { has_building = "building_colony_shelter" }
		set_deposit = d_energy_deposit
		random_neighboring_tile = {
			limit = { has_building = "building_primitive_farm" }
			clear_deposits = yes
		}
		random_neighboring_tile = {
			limit = { has_building = "building_primitive_farm" }
			clear_deposits = yes
		}
	}
	random_tile = {
		limit = { has_building = "building_basic_science_lab_1" }
		clear_deposits = yes
		remove_building = yes
		set_building = "building_primitive_farm"
	}		
	random_tile = {
		limit = { has_deposit = "d_engineering_deposit" has_building = no }
		if = {
			limit = { 
				owner = { has_civic = civic_machine_terminator }
			}
			set_blocker = "tb_former_battlefield"
			else = {
				set_blocker = "tb_bomb_crater"
			}
		}	
	}
	random_tile = {
		limit = { has_deposit = "d_society_deposit" has_building = no }
		if = {
			limit = { 
				owner = { has_civic = civic_machine_terminator }
			}
			set_blocker = "tb_former_battlefield"
			else = {
				set_blocker = "tb_bomb_crater"
			}
		}	
	}
	random_tile = {
		limit = { has_deposit = "d_physics_deposit" has_building = no }		
		if = {
			limit = { 
				owner = { has_civic = civic_machine_terminator }
			}
			set_blocker = "tb_exterminators_ruins"
			else = {
				set_blocker = "tb_radioactive_wasteland"
			}
		}	
	}
	random_tile = {
		limit = { has_deposit = "d_rich_energy_deposit" has_building = no }
		if = {
			limit = { 
				owner = { has_civic = civic_machine_terminator }
			}
			set_blocker = "tb_exterminators_ruins"
			else = {
				set_blocker = "tb_radioactive_wasteland"
			}
		}
	}
	random_tile = {
		limit = { has_deposit = "d_rich_farmland_deposit" has_building = no }
		random_list = {
			33 = {
				set_deposit = d_engineering_deposit
			}
			33 = {
				set_deposit = d_society_deposit
			}
			33 = {
				set_deposit = d_physics_deposit
			}
		}
	}
	random_tile = { # Turns one farm tile into empty tile
		limit = {
			OR = {
				has_deposit = "d_farmland_deposit"
				has_deposit = "d_rich_farmland_deposit"
				has_deposit = "d_mineral_food_deposit"
				has_deposit = "d_rich_food_mineral_deposit"
				has_deposit = "d_vast_farmland_deposit"
				has_deposit = "d_immense_farmland_deposit"
			}
		}
		clear_deposits = yes
	}
	every_tile = {
		limit = { has_deposit = "d_farmland_deposit" }
		clear_deposits = yes
		random_list = {
			35 = {
				set_deposit = d_energy_deposit
			}
			35 = {
				set_deposit = d_mineral_deposit
			}
		}
	}
	every_tile = {
		limit = {
			OR = {
				has_deposit = "d_rich_farmland_deposit"
				has_deposit = "d_mineral_food_deposit"
				has_deposit = "d_rich_food_mineral_deposit"
			}
		}
		clear_deposits = yes
		random_list = {
			10 = {
				set_deposit = d_rich_engineering_deposit
			}
			10 = {
				set_deposit = d_rich_society_deposit
			}
			10 = {
				set_deposit = d_rich_physics_deposit
			}
			35 = {
				set_deposit = d_rich_energy_deposit
			}
			35 = {
				set_deposit = d_rich_mineral_deposit
			}
		}
	}
	every_tile = {
		limit = { has_deposit = "d_vast_farmland_deposit" }
		clear_deposits = yes
		random_list = {
			10 = {
				set_deposit = d_vast_engineering_deposit
			}
			10 = {
				set_deposit = d_vast_society_deposit
			}
			10 = {
				set_deposit = d_vast_physics_deposit
			}
			35 = {
				set_deposit = d_vast_energy_deposit
			}
			35 = {
				set_deposit = d_vast_mineral_deposit
			}
		}
	}
	every_tile = {
		limit = { has_deposit = "d_immense_farmland_deposit" }
		clear_deposits = yes
		random_list = {
			10 = {
				set_deposit = d_immense_engineering_deposit
			}
			10 = {
				set_deposit = d_immense_society_deposit
			}
			10 = {
				set_deposit = d_immense_physics_deposit
			}
			35 = {
				set_deposit = d_immense_energy_deposit
			}
			35 = {
				set_deposit = d_immense_mineral_deposit
			}
		}
	}
	if = { # Ensures at least one empty tile, if no farm tile was generated to nuke
		limit = { any_tile = { NOT = { has_deposit = no } } }
		random_tile = {
			limit = { has_blocker = no has_building = no has_deposit = yes }
			clear_deposits = yes
		}
		else = {
			# Do nothing
		}
	}
}

reset_start_buildings_and_blockers_life_seeded = { # Selectively resets necessary tiles for Life-Seeded Civic users. Is triggered after "generate_start_buildings_and_blockers" by game_start.34
	# Find capitol and buildings, and then remove them
	# This is needed because planet's deposits were re-rolled after
	every_tile = {
		limit = { has_building = yes }
		remove_building = yes
	}
	# Set up a new capitol and nearby buildings
	random_tile = {
		limit = { has_blocker = no has_building = no num_adjacent_tiles > 3 }
		set_building = "building_colony_shelter"
		set_deposit = d_energy_deposit	
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_primitive_farm"
			set_deposit = d_rich_farmland_deposit						
		}
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_primitive_farm"
			set_deposit = d_rich_farmland_deposit						
		}
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_primitive_power_plant"
			set_deposit = d_rich_energy_deposit
		}
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			# set_building = "building_mining_network_1"		# Deprecated Vanilla Code
			set_deposit = d_rich_mineral_deposit
		}
	}
	
	# Add the lab
	# Has pop = yes to make sure they use the tiles that were first generated for this task
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = yes  }
		set_building = "building_basic_science_lab_1"
		random_list = {
			33 = {
				set_deposit = d_engineering_deposit										
			}
			33 = { 
				set_deposit = d_society_deposit											
			}
			33 = { 
				set_deposit = d_physics_deposit											
			}					
		}	
	}
	# Add mine and power plant
	# Has pop = yes to make sure they use the tiles that were first generated for this task
	# random_tile = {	# Deprecated Vanilla Code
	#	limit = { has_blocker = no has_building = no has_pop = yes }
	#	set_building = "building_mining_network_1"
	#	set_deposit = d_mineral_deposit
	#}
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = yes  }
		set_building = "building_primitive_power_plant"
		set_deposit = d_rich_energy_deposit
	}
	
	# Move pops to tiles
	every_tile = {
		limit = { has_building = yes has_pop = no }
		
		save_event_target_as = needs_worker	
		planet = {
			weighted_random_owned_pop_group = {
				limit = { tile = { has_building = no } }

				resettle_pop = {
					pop = this
					tile = event_target:needs_worker
				}
			
			}		
		}
	}
	# Add blockers
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = no }
		set_blocker = "tb_failing_infrastructure"
		set_deposit = d_mineral_deposit
    }
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = no }
		set_blocker = "tb_failing_infrastructure"
		set_deposit = d_engineering_deposit
    }
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = no  }
		set_blocker = "tb_failing_infrastructure"
		set_deposit = d_society_deposit
    }
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = no }
		set_blocker = "tb_failing_infrastructure"
		set_deposit = d_physics_deposit
    }
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = no }
		set_blocker = "tb_decrepit_dwellings"
		set_deposit = d_rich_energy_deposit
    }
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = no }
		set_blocker = "tb_decrepit_dwellings"
		set_deposit = d_rich_energy_deposit
    }
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = no }
		set_blocker = "tb_decrepit_dwellings"
		set_deposit = d_rich_farmland_deposit		
    }
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = no }
		set_blocker = "tb_decrepit_dwellings"
		set_deposit = d_rich_mineral_deposit		
    }
}
