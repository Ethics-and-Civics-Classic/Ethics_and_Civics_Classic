namespace = country

###################################
### Sublight Exploration Probes ###
###################################
country_event = {
	id = country.258
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				OR = {
					has_country_flag = story1
					has_country_flag = story2
					has_country_flag = story3
					has_country_flag = story4
					has_country_flag = story5
					has_country_flag = story6
					has_country_flag = story7
					num_communications > 1
				}
				NOR = {
					has_origin = origin_primitive_player_pre_industrial_age 
					has_origin = origin_primitive_player_industrial_age 
					has_origin = origin_primitive_player_machine_age 
					has_origin = origin_primitive_player_atomic_age
					has_origin = origin_primitive_player_early_space_age
				}
			}
			country_event = { id = country.1 }
		}
		else = {
			country_event = { id = country.258 days = 180 }
		}
	}
}

####################
### Radical Cult ###
####################
country_event = {
	id = country.200
	title = "country.200.name"
	desc = {
		trigger = {
			owner = {
				country_uses_bio_ships = no
			}
		}
		text = "country.200.desc"
	}
	desc = {
		trigger = {
			owner = {
				country_uses_bio_ships = yes
			}
		}
		text = "country.200.desc.bio"
	}
	picture = GFX_evt_alien_propaganda
	show_sound = event_ship_thrusters
	location = event_target:cultist_ship
	event_chain = radical_cult

	is_triggered_only = yes

	trigger = {
		NOR = {
			has_ethic = ethic_gestalt_consciousness
			has_country_flag = starting_event
		}
		is_ai = no
		has_technology = "tech_starbase_2"	# Cogger note - For PrimPlay compatibility, may break event without it
	}

	immediate = {
		set_country_flag = starting_event
		save_event_target_as = owner_country
		capital_scope = {
			solar_system = {
				random_system_planet = {
					limit = {
						is_capital = no
						is_asteroid = no
						is_star = no
						is_moon = no
						NOT = { is_planet_class = pc_gas_giant }
					}
					save_event_target_as = hijacked_fleet_planet
				}
			}
		}
		owner_species = { save_event_target_as = owner_species }
		create_country = {
			name = "NAME_Radical_Cult"
			species = event_target:owner_species
			type = nice_faction
			name_list = ROOT
			auto_delete = no
			effect = {
				set_graphical_culture = root
				save_event_target_as = cultist_faction
				set_country_flag = radical_cult
				establish_communications_no_message = root
				establish_contact = { who = root location = root.capital_scope }
				create_leader = {
					class = commander
					species = owner_main_species
					name = random
					skill = 2
					background_ethic = ethic_spiritualist
					background_planet = root.capital_scope
					background_job = commanding_officer
				}
				last_created_leader = {
					add_trait = {
						trait = leader_trait_crusader_2
					}
					save_event_target_as = cultist_admiral
				}
				create_fleet = {
					name = "NAME_Hijacked_Fleet"
					effect = {
						set_owner = prev
						save_event_target_as = cultist_fleet
						if = {
							limit = {
								root.owner = {
									country_uses_bio_ships = no
								}
							}
						create_ship_design = {
								design = "NAME_Dagger"
							}
						}
						else = {
							create_ship_design = {
								design = "NAME_CHARGER_1"
							}
						}
						create_ship = {
							name = "NAME_Unyielding_Faith"
							design = last_created_design
							growth_stage = 1
						}
						create_ship = {
							name = "NAME_Holy_Avatar"
							design = last_created_design
							growth_stage = 1
						}
						create_ship = {
							name = "NAME_Divine_Fury"
							design = last_created_design
							growth_stage = 1
							effect = {
								set_ship_flag = cultist_ship
								set_disable_at_health = 0.05
								save_event_target_as = cultist_ship
							}
						}
						set_location = event_target:hijacked_fleet_planet
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = return_point
						set_aggro_range = 50
						assign_leader = last_created_leader
						queue_actions = {
							repeat = {
								wait = {
									duration = 100
								}
							}
						}
					}
				}
				add_ship_design = last_created_design
				save_event_target_as = radical_cult
				set_name = random
				set_country_flag = cultist_rebels_of@root
			}
		}
		begin_event_chain = {
			event_chain = "radical_cult"
			target = ROOT
		}
	}

	option = {
		name = "country.200.a"
		tooltip = {
			begin_event_chain = {
				event_chain = "radical_cult"
				target = ROOT
			}
		}
		hidden_effect = {
			event_target:cultist_faction = {
				set_faction_hostility = {
					target = root
					set_hostile = yes
					set_neutral = no
					set_friendly = no
				}
			}
			create_point_of_interest = {
				id = radical_cult_poi.1
				name = "hijacked_cult_fleet_poi"
				desc = "hijacked_cult_fleet_poi_desc"
				event_chain = "radical_cult"
				location = event_target:cultist_ship
			}
		}
	}
	option = {
		name = "country.200.b"
		allow = {
			resource_stockpile_compare = {
				resource = unity
				value >= 125
			}
		}
		add_resource = { unity = -125 }
		event_target:cultist_fleet = {
			set_owner = ROOT
			set_disable_at_health = no
		}
		hidden_effect = {
			event_target:cultist_admiral = {
				set_owner = ROOT
			}
			random_list = {
				80 = {
					# Nothing happens
				}
				20 = {
					# You get their flagship!
					country_event = {
						id = country.225
						days = 360
						random = 30
					}
				}
			}
		}
		end_event_chain = "radical_cult"
	}
}

## 1050 final catchup with scientist	# Cogger Note - Overwriting vanilla is not worth doing for unless it breaks this event
# ship_event = {
#	id = country.1050
#	title = "country.1050.name"
#	desc = "country.1050.desc"
#	show_sound = event_scanner
#	picture = GFX_evt_ship_in_orbit
#	location = root
#
#	is_triggered_only = yes
#
#	trigger = {
#		from = { has_star_flag = scientist_system_5 }
#		owner = {
#			has_event_chain = "rogue_scientist_3_chain"
#			NOT = { has_country_flag = scisys_5 }
#		}
#	}
#
#	immediate = {
#		owner = {
#			set_country_flag = scisys_5
#			random_owned_leader = {				# Cogger Note - PrimPlay used this limit, seems like deprecated code.
#				limit = {
#					leader_class = scientist
#				}
#				save_event_target_as = scientist_portrait
#			}
#		}
#		solar_system = {
#			random_system_planet = {
#				limit = { is_star = yes }
#				save_event_target_as = ship_position
#			}
#		}
#		owner = {
#			save_event_target_as = owner_country
#			remove_point_of_interest = scientist_system_5
#			add_event_chain_counter = {
#				event_chain = "rogue_scientist_3_chain"
#				counter = "scientist_apprehended"
#				amount = 1
#			}
#			create_fleet = {
#				name = "NAME_Burnt-Out_Science_Ship"
#				effect = {
#					set_owner = prev
#					create_ship_design = {
#						design = "NAME_Prototype"
#					}
#					create_ship = {
#						name = "NAME_Research_Expedition_Vessel"
#						prefix = no
#						design = last_created_design
#						graphical_culture = event_target:owner_country
##						upgradable = no		# Cogger Note - PrimPlay allowed this to be upgraded.
#						effect = {
#							set_ship_flag = wandering_scientist_ship
#							set_disabled = yes
#							save_event_target_as = wandering_ship
#						}
#					}
#					set_fleet_flag = wandering_scientist_fleet_flag
#					set_location = event_target:ship_position
#				}
#			}
#		}
#	}
#
#	option = {
#		name = ONSCREEN
#		hidden_effect = { owner = { country_event = { id = country.1051 } } }
#	}
#}
#
