namespace = nations

#player chooses tile cleared and attitude
planet_event = {
	id = nations.1
	title = "Tile Cleared"
	desc = "An independent nation on our homeworld has expressed alarm over our recent activity near their borders"
	diplomatic = yes
	picture_event_data = { #Specifies picture for diplomatic event. Most options are optional here
		portrait = owner #Animated portrait. Accepts country, leader or species scope as an input
		planet_background = owner #Planet background, if your picture has a window
		graphical_culture = owner #City on the planet in the window
		city_level = owner #The size of the city. Usable to make planet behind look like capital
		room = owner.ruler #Static background. Can use static pictures or scopes as the input
	}

	is_triggered_only = yes
	
	trigger = { 
		is_same_value = owner.capital_scope
		owner = { is_ai = no } 
	}
	
	option = {
		name = "Merely infrastructure development. (Clearing a normal tile blocker)"
		random_list = {
			1 = { planet_event = { id = nations.3 } }
			99 = {}
		}
	}
	
	option = {
		name = "Ask them to join our government. (Peacefully absorb your own species)"
		random_list ={
			10 = { planet_event = { id = nations.3 } }
			40 = { planet_event = { id = nations.2 } }
			50 = { best_tile_for_pop = { set_blocker = tb_enemy } }
		}
	}
	
	option = {
		name = "Demand they submit. (War to conquer the pop)"
		planet_event = { id = nations.3 }
	}
	
	option = {
		name = "Ask them to join us. (Peacefully absorb your syncretic / organic species)"
		allow = {
			owner = {
				OR = {
					has_civic = civic_machine_assimilator
					has_civic = civic_machine_servitor
					has_civic = civic_syncretic_evolution
					any_owned_pop = { owner_species = { is_same_species  = no } } 
				}
			}
		}
		random_list ={
			10 = { planet_event = { id = nations.301 } }
			20 = { planet_event = { id = nations.201 } }
			70 = { best_tile_for_pop = { set_blocker = tb_2nd_enemy } }
		}
	}
	
	option = {
		name = "Demand they submit. (War to conquer the pop)"
		allow = {
			owner = {
				OR = {
					has_civic = civic_machine_assimilator
					has_civic = civic_machine_servitor
					has_civic = civic_syncretic_evolution
					any_owned_pop = { owner_species = { is_same_species  = no } } 
				}
			}
		}
		planet_event = { id = nations.301 }
	}
}

# own species joins
planet_event = {
	id = nations.2
	hide_window = yes
	title = "Peaceful Integration"
#	desc = "setup2 worked"
	is_triggered_only = yes
	
	immediate = {
		best_tile_for_pop = { 
			random_list = {
				1 = {
					modifier = {
						factor = 0
							not = { owner = { is_militarist = yes } }
					}	
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_pacifist }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_pacifist = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_militarist }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_spiritualist = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_materialist }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_materialist = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_spiritualist }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_authoritarian = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_egalitarian }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_egalitarian = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_authoritarian }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_xenophobe = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_xenophile }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_xenophile = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_xenophobe }
				}
			}
		}
	}
}

# 2nd species joins
planet_event = {
	id = nations.201
	hide_window = yes
	title = "Peaceful Subjugation"
#	desc = "setup2 worked"
	is_triggered_only = yes
	
	immediate = {
		best_tile_for_pop = { 
			random_list = {
				1 = {
					modifier = {
						factor = 0
							not = { owner = { is_militarist = yes } }
					}	
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_pacifist }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_pacifist = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_militarist }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_spiritualist = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_materialist }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_materialist = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_spiritualist }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_authoritarian = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_egalitarian }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_egalitarian = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_authoritarian }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_xenophobe = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_xenophile }
				}
				1 = {
					modifier = {
						factor = 0
						not = { owner = { is_xenophile = yes } }
					}
					create_pop = { species = owner_species ethos = random }
					last_created_pop = { pop_change_ethic = ethic_xenophobe }
				}
			}
		}
	}
}

#War starts
planet_event = {
	id = nations.3
	title = "War on our homeworld!"
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle
	location = this
	
	is_triggered_only = yes
	
	immediate = {
		create_rebels = {
			species = owner.owner_species
			ethos = random
			authority = random
			name = random
			flag = random
			effect = {
				set_country_flag = standard_unrest_rebels
				save_global_event_target_as = homeworld_rebels
				establish_communications_no_message = root.owner
			}
		}
		create_army = {
			owner = event_target:homeworld_rebels
			species = event_target:homeworld_rebels
			type = "rebel_army"
		}
		create_army = {
			owner = event_target:homeworld_rebels
			species = event_target:homeworld_rebels
			type = "postatomic_army"
		}
		every_tile = { limit = { has_blocker = tb_enemy }
			planet = {
				if = { limit = { owner = { has_technology = tech_assault_armies } }
					create_army = {
						owner = event_target:homeworld_rebels
						species = event_target:homeworld_rebels
						type = "assault_army"
					}
					else = {
						create_army = {
							owner = event_target:homeworld_rebels
							species = event_target:homeworld_rebels
							type = "postatomic_army"
						}
					}
				}
			}
		}
	}	
}

#war with 2nd species 301 home_2nd_rebels
planet_event = {
	id = nations.301
	title = "War on our homeworld!"
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle
	location = this
	
	is_triggered_only = yes
	
	immediate = {
		create_rebels = {
			species = owner.owner_species
			ethos = random
			authority = random
			name = random
			flag = random
			effect = {
				set_country_flag = standard_unrest_rebels
				save_global_event_target_as = homeworld_rebels
				establish_communications_no_message = root.owner
			}
		}
		create_army = {
			owner = event_target:homeworld_rebels
			species = event_target:homeworld_rebels
			type = "rebel_army"
		}
		create_army = {
			owner = event_target:homeworld_rebels
			species = event_target:homeworld_rebels
			type = "postatomic_army"
		}
		every_tile = { limit = { has_blocker = tb_enemy }
			planet = {
				if = { limit = { owner = { has_technology = tech_assault_armies } }
					create_army = {
						owner = event_target:homeworld_rebels
						species = event_target:homeworld_rebels
						type = "assault_army"
					}
					else = {
						create_army = {
							owner = event_target:homeworld_rebels
							species = event_target:homeworld_rebels
							type = "postatomic_army"
						}
					}
				}
			}
		}
	}	
}

#Enemy reinforces 31
planet_event = {
	id = nations.31
	title = "Enemy Reinforcements!"
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle
	location = this
	
	trigger = { 
		exists = owner
        has_owner = yes 
        original_owner = yes
        is_homeworld = yes 
        owner = { is_ai = no } 
        has_ground_combat = yes 
        is_capital = yes 	
		any_tile = { has_blocker = tb_enemy }
	}
	
	mean_time_to_happen = { days = 90 }
	
	immediate = {
		every_tile = { limit = { has_blocker = tb_enemy }
			random_list = {
				1 = {
					owner.capital_scope = { 
						create_army = {
							owner = event_target:homeworld_rebels
							species = event_target:homeworld_rebels
							type = "postatomic_army"
						}
					}
				}
				1 = {
					owner.capital_scope = { 
						create_army = {
							owner = event_target:homeworld_rebels
							species = event_target:homeworld_rebels
							type = "rebel_army"
						}
					}
				}
				1 = {}
			}
		}
	}

	option = {
		name = "Our troops will handle the situation."
	}
	
	option = {
		name = "Mobilize the reserves."
		allow = {
			owner = { has_country_resource = { type = minerals amount > 25 }}
		}
		owner = {
			every_owned_pop = { #limit = { planet = { is_same_value = prev.capital_scope } }
				while = { 
					limit = { owner = { has_country_resource = { type = minerals amount > 25 } } }				
					random_list = {
						1 = {
							prev.capital_scope = {
								create_army = {
									owner = prev.owner
									species = prev.owner_species
									type = "postatomic_army"
								}
							}
							owner = { add_minerals = -25 }
						}
						1 = {}
					}
				}
			}
		}
	}
	
	option = {
		name = "Call for volunteers."
		allow = {
			owner = { 
				has_country_resource = { type = minerals amount > 5 }
				has_country_resource = { type = influence amount > 1 }
			}
		}
		owner = {
			every_owned_pop = { #limit = { planet = { is_same_value = prev.capital_scope } }
				while = {
					limit = { 
						owner = { 
							has_country_resource = { type = minerals amount > 5 } 
							has_country_resource = { type = influence amount > 1 }
						}
					}
					random_list = {
						1 = {
							prev.capital_scope = {
								create_army = {
									owner = prev.owner
									species = prev.owner_species
									type = "rebel_army"
								}
							}
							owner = { add_minerals = -5 add_influence = -1 }
						}
						1 = {}
					}
				}
			}
		}
	}
	
	option = {
		name = "Order limited nuclear strikes."
		allow = {
			owner = { 
				has_country_resource = { type = unity amount > 20 }
				has_country_resource = { type = influence amount > 20 }
			}
		}
		owner = {
			add_influence = -20
			add_unity = -20
#			add_planet_unrest = 10	
		}
		
		best_tile_for_pop = { set_blocker = "tb_radioactive_wasteland" }
		
		event_target:homeworld_rebels = {
			while = {
				count = 5
				random_owned_army = { #limit = { planet = { is_same_value = PREVPREV } } 
					remove_army = yes 
				}
			}
		}
		
		random_list = {
			1 = {}
			2 = {
				random_tile = { 
					limit = { 
						has_grown_pop = yes 
						has_building = yes 
					} 
				set_blocker = "tb_bomb_crater"
				}
			}
			4 = {
				owner = {
					while ={
						count = 5
						random_owned_army = { remove_army = yes }
					}
				}
				best_tile_for_pop = { set_blocker = "tb_radioactive_wasteland" }
			}
			1 = {
				change_pc = pc_nuked
				random_tile = { set_blocker = "tb_radioactive_wasteland" }
				random_tile = { set_blocker = "tb_radioactive_wasteland" }
				random_tile = { limit = { has_building = yes } set_blocker = "tb_bomb_crater" }
				random_tile = { limit = { has_building = yes } set_blocker = "tb_bomb_crater" }
				random_tile = { limit = { has_building = yes } set_blocker = "tb_city_ruins" }
				random_tile = { limit = { has_building = yes } set_blocker = "tb_city_ruins" }
				
				owner = { 
					every_owned_pop = {
						random_list = {
							3 = { kill_pop = yes }
							1 = {}
						}
					}
					while = { count = 50 random_owned_army = { remove_army = yes } }
				}
				
				event_target:homeworld_rebels = { while =  { count = 50 random_owned_army = { remove_army = yes } }	}			
			}
		}
	}
}


#Hostiles expand
planet_event = {
	id = nations.4
	title = "Hostile expansion"
	desc = "An independent nation on our homeworld has laid claim to additional territory."
	location = capital_scope
	diplomatic = yes
	picture_event_data = { #Specifies picture for diplomatic event. Most options are optional here
		portrait = owner #Animated portrait. Accepts country, leader or species scope as an input
		planet_background = owner #Planet background, if your picture has a window
		graphical_culture = owner #City on the planet in the window
		city_level = owner #The size of the city. Usable to make planet behind look like capital
		room = owner.ruler #Static background. Can use static pictures or scopes as the input
	}
	
	trigger = { 
		exists = owner
        has_owner = yes 
        original_owner = yes
        is_homeworld = yes 
        owner = { is_ai = no } 
        has_ground_combat = no 
        free_pop_tiles > 0
        is_capital = yes 	
		owner.capital_scope = { any_tile = { has_blocker = tb_enemy } }
	}
	
	mean_time_to_happen = { years = 10 }
	
	option = {
		name = "Grudgingly tolerate it."
		best_tile_for_pop = {
			set_blocker = tb_enemy
		}
	}
	
	option = {
		name = "Diplomatically suggest they reconsider."
		random_list = {
			45 = { }
			50 = { best_tile_for_pop = { set_blocker = tb_enemy } }
			5 = { 
				best_tile_for_pop = { set_blocker = tb_enemy }
				planet_event = { id = nations.3 } 
			}
		}
	}
	
	option = {
		name = "Demand they cease."
		random_list ={
			20 = { }
			50 = { best_tile_for_pop = { set_blocker = tb_enemy } }
			30 = { 
				best_tile_for_pop = { set_blocker = tb_enemy }
				planet_event = { id = nations.3 } 
			}
		}
	}
	
	option = {
		name = "Punish their insolence."
		best_tile_for_pop = { set_blocker = tb_enemy }
		planet_event = { id = nations.3 }			
	}
}
	
#Hostile 2ndaries expand

#Hostile own species defeated	
# defender = planet owner
# Triggers country_event for the defender upon victory
# Root = country, planet owner
# From = country, attack leader
# FromFrom = planet	
country_event = {
	id = nations.6
	hide_window = yes

	
	is_triggered_only = yes
	
	trigger = { 
		root = { is_ai = no }
		root.capital_scope = { any_tile = { has_blocker = tb_enemy } }
	}
	
	immediate = { 
		root.capital_scope = {
			best_tile_for_pop = { 
				random_list = {
					1 = {
						modifier = {
							factor = 0
							not = { root = { is_militarist = yes } }
						}	
						create_pop = { species = root.owner_species ethos = random }
						last_created_pop = { 
							pop_change_ethic = ethic_pacifist 
							add_modifier = {
								modifier = pop_recently_conquered
								years = 5
							}
						}
					}
					1 = {
						modifier = {
							factor = 0
							not = { root = { is_pacifist = yes } }
						}
						create_pop = { species = root.owner_species ethos = random }
						last_created_pop = { 
							pop_change_ethic = ethic_militarist 
							add_modifier = {
								modifier = pop_recently_conquered
								years = 5
							}
						}
					}
					1 = {
						modifier = {
							factor = 0
							not = { root = { is_spiritualist = yes } }
						}
						create_pop = { species = root.owner_species ethos = random }
						last_created_pop = { 
							pop_change_ethic = ethic_materialist 
							add_modifier = {
								modifier = pop_recently_conquered
								years = 5
							}
						}
					}
					1 = {
						modifier = {
							factor = 0
							not = { root = { is_materialist = yes } }
						}
						create_pop = { species = root.owner_species ethos = random }
						last_created_pop = { 
							pop_change_ethic = ethic_spiritualist 
							add_modifier = {
								modifier = pop_recently_conquered
								years = 5
							}
						}
					}
					1 = {
						modifier = {
							factor = 0
							not = { root = { is_authoritarian = yes } }
						}
						create_pop = { species = root.owner_species ethos = random }
						last_created_pop = { 
							pop_change_ethic = ethic_egalitarian 
							add_modifier = {
								modifier = pop_recently_conquered
								years = 5
							}
						}
					}
					1 = {
						modifier = {
							factor = 0
							not = { root = { is_egalitarian = yes } }
						}
						create_pop = { species = root.owner_species ethos = random }
						last_created_pop = { 
							pop_change_ethic = ethic_authoritarian 
							add_modifier = {
								modifier = pop_recently_conquered
								years = 5
							}
						}
					}
					1 = {
						modifier = {
							factor = 0
							not = { root = { is_xenophobe = yes } }
						}
						create_pop = { species = root.owner_species ethos = random }
						last_created_pop = { 
							pop_change_ethic = ethic_xenophile 
							add_modifier = {
								modifier = pop_recently_conquered
								years = 5
							}
						}
					}
					1 = {
						modifier = {
							factor = 0
							not = { root = { is_xenophile = yes } }
						}
						create_pop = { species = root.owner_species ethos = random }
						last_created_pop = { 
							pop_change_ethic = ethic_xenophobe 
							add_modifier = {
								modifier = pop_recently_conquered
								years = 5
							}
						}
					}
				}
			}
		}
	}
}

# 2nd species defeated
